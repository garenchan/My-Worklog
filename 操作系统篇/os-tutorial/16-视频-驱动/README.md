# 视频-驱动


## 概念

VGA字符单元格、屏幕偏移量


## 目标

**在屏幕上写字符串**

最后，我们将能够在屏幕上输出文本。这节课比平常多了一些代码，所以让我们一步一步来。

打开文件`drivers/screen.h`，你将看到我们为VGA卡驱动程序和三个公共函数定义了一些常
量，一个用来清除屏幕，另外两个用来写字符串，`kprint`以“内核打印”著称。

现在打开文件`drivers/screen.c`，它从声明私有工具函数开始，我们将使用这些函数来辅
助`kprint`内核API。

有两个我们在上一课中学过的I/O端口访问例程，`get`和`set_cursor_offset()`。

还有一个直接操作显存的例程，`print_char()`。

最后，有三个工具函数用于行和列与偏移量之间的相互转换。


## kprint_at

可以用`col`和`row`的-1值调用`kprint_at`，这表示我们将在当前光标位置打印字符串。

它首先为col/row和offset定义了三个变量，然后遍历`char*`并使用当前坐标调用`print_char()`。

注意，`print_char`本身会返回下一个光标位置的偏移量，我们将在下一次迭代中使用它。

`kprint`只是对`kprint_at`进行了简单的封装。


## print_char

和`kprint_at`一样，`print_char`允许参数cols/rows为`-1`。在这种情况下，它将使用`ports.c`
中的例程从硬件检索光标位置。

`print_char`也会处理换行。在这种情况下，我们将把光标移动到下一行的第0列。

记住，VGA单元格需要两个字节，一个用于字符本身，另一个用于属性。


## kernel.c

我们的新内核终于能够打印字符串了。

它测试正确的字符定位，跨越多行、换行，最后尝试在屏幕边界之外写入。然后会发生什么呢？

下节课我们将学习如何滚动屏幕。
