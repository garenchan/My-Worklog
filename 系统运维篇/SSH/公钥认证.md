# SSH公钥认证

## 为什么不用口令认证

我们大都比较熟悉SSH的“口令认证”方式，也就是需要输入用户名和对应的密码；然后通常SSH客户端会输出几行如下所示的提示信息:

    The authenticity of host 'host (12.18.429.21)' can't be established. 
    RSA key fingerprint is 98:2e:d7:e0:de:9f:ac:67:28:c2:42:2d:37:16:58:4d. 
    Are you sure you want to continue connecting (yes/no)?

大致意思就是，无法确认host主机的真实性，只知道它的公钥指纹，问您是否继续连接吗？

为什么要提示这些信息呢？因为口令认证不能保证你正在连接的服务器就是你想连接的服务器，可能有别的服务器在冒充真正的服务器，也就是容易受到“中间人”攻击。为了验证服务器的真实性，你需要手动核对公钥指纹，通常这很繁琐也不一定可行（除非服务器在某个地方公示出的公钥指纹）。

出于安全原因以及每次连接都需要输入密码，所以建议还是不要使用“口令认证”。


## 公钥认证优点

SSH协议支持许多身份验证方法，可以说，其中最重要的一个是用于交互和自动连接的公钥身份验证。

相比简单密码，公钥认证提供了即使是非常长的密码也无法提供的加密强度，另外用户也不需要记住这些密码或者将它们写下，因此能极大提升安全性。

除了安全性以外，公钥认证还提供了一系列可用性优势--单点认证、免密登陆。


## 公钥认证关键概念

- 非对称加密算法，譬如RSA和DSA

- 密钥对

    - 公钥
        公钥用于分发到SSH服务器
    - 私钥
        私钥由用户自己保留，它是用户身份的证明


## 配置公钥认证

1. 用户生成密钥对，通常使用 ``ssh-keygen`` 来完成:

    ssh-keygen

2. 用户自行保留私钥，将公钥分发到SSH服务器上，通常使用 ``ssh-copy-id`` 来完成:

    ssh-copy-id -i <pub_key> user@server

3. SSH服务器存储用户的公钥并标记为 ``authorized``，通常是将公钥字符串追加到某个文件中，譬如 ``authorized_keys``

4. 用户使用私钥进行SSH连接
